<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë‚˜ì˜ ì‹œí¥ â€¢ ì‰ì–´ìŠ¤íŒŸ</title>

  <!-- ê³µí†µ ìŠ¤íƒ€ì¼ + ë§ˆì´í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ -->
  <link rel="stylesheet" href="../Css/style.css" />
  <link rel="stylesheet" href="../Css/my.css" />
</head>

<body>
  <!-- ì‚¬ì´ë“œë°” -->
  <div class="sidebar">
    <div class="brand">
      <img src="../Images/logo.png" alt="ë¡œê³ " class="brand-logo" />
      <div class="brand-text">
        <h1>ì‰ì–´ìŠ¤íŒŸ</h1>
        <p>ì‹œí¥ì‹œ ì •ì™•ë™</p>
      </div>
    </div>

    <div class="menu">
      <a href="./main.html" class="menu-item">
        <span class="menu-icon">ğŸ </span> í™ˆ
      </a>

      <a href="./near_me.html" class="menu-item">
        <span class="menu-icon">ğŸ“</span> ë‚´ ê·¼ì²˜
      </a>

      <a href="./chat.html" class="menu-item">
        <span class="menu-icon">ğŸ’¬</span> ì±„íŒ…
        <span class="badge">3</span>
      </a>

      <a href="./my.html" class="menu-item active">
        <span class="menu-icon">ğŸ‘¤</span> ë‚˜ì˜ ì‹œí¥
      </a>
    </div>

    <a href="#" class="login" id="logoutBtn">
      <span>ğŸ“•</span> ë¡œê·¸ì•„ì›ƒ
    </a>
  </div>

  <!-- ë©”ì¸ -->
  <div class="main-content">
    <div class="top-header">
      <div class="search-bar">
        <span>ğŸ”</span> ë¬¼í’ˆ, ë™ë„¤ ì´ë¦„ ë“±ì„ ê²€ìƒ‰í•´ë³´ì„¸ìš”
      </div>
      <div class="header-actions">
        <button class="write-btn" onclick="location.href='upload.html'">
          <span>âœï¸</span> ê¸€ì“°ê¸°
        </button>
      </div>
    </div>

    <div class="content-wrapper mypage">
      <!-- í”„ë¡œí•„ ì¹´ë“œ -->
      <section class="profile-card card">
        <div class="avatar" id="avatarText">?</div>
        <div class="profile-meta">
          <h2 class="nickname" id="nicknameText">ë¡œë”©ì¤‘...</h2>
          <p class="location" id="dongText">ë¡œë”©ì¤‘...</p>
        </div>
        <button class="btn-outline" id="btnEditProfile">í”„ë¡œí•„ ìˆ˜ì •</button>
      </section>

      <!-- ìŠ¤íƒ¯ -->
      <section class="stats">
        <div class="stat stat-share">
          <div class="stat-value" id="statShared">0</div>
          <div class="stat-label">ê³µìœ í•œ ë¬¼í’ˆ</div>
        </div>
        <div class="stat stat-thanks">
          <div class="stat-value" id="statThanks">0</div>
          <div class="stat-label">ë°›ì€ ê°ì‚¬</div>
        </div>
        <div class="stat stat-trust">
          <div class="stat-value" id="statTrust">0%</div>
          <div class="stat-label">ì‹ ë¢°ë„</div>
        </div>
      </section>

      <!-- í•˜ë‹¨ 2ì—´ -->
      <section class="two-col">
        <!-- ë‚˜ì˜ í™œë™ -->
        <article class="panel card">
          <header class="panel-header">ë‚˜ì˜ í™œë™</header>
          <ul class="panel-list">
            <li class="panel-item">
              <div class="item-left">
                <span class="icon">ğŸ§¾</span>
                <span>íŒë§¤/ëŒ€ì—¬ ë‚´ì—­</span>
              </div>
              <div class="item-right">
                <span class="chip" id="chipHistory">3</span>
                <span class="chevron">â€º</span>
              </div>
            </li>
            <li class="panel-item">
              <div class="item-left">
                <span class="icon">â­</span>
                <span>ê´€ì‹¬ëª©ë¡</span>
              </div>
              <div class="item-right">
                <span class="chip" id="chipWish">12</span>
                <span class="chevron">â€º</span>
              </div>
            </li>
            <li class="panel-item">
              <div class="item-left">
                <span class="icon">âœï¸</span>
                <span>ë‚´ê°€ ì“´ ê¸€</span>
              </div>
              <div class="item-right">
                <span class="chevron">â€º</span>
              </div>
            </li>
          </ul>
        </article>

        <!-- ì„¤ì • -->
        <article class="panel card">
          <header class="panel-header">ì„¤ì •</header>
          <ul class="panel-list">
            <li class="panel-item">
              <div class="item-left">
                <span class="icon">ğŸ””</span>
                <span>ì•Œë¦¼ ì„¤ì •</span>
              </div>
              <div class="item-right"><span class="chevron">â€º</span></div>
            </li>
            <li class="panel-item">
              <div class="item-left">
                <span class="icon">ğŸ‘¤</span>
                <span>ê³„ì • ì„¤ì •</span>
              </div>
              <div class="item-right"><span class="chevron">â€º</span></div>
            </li>
            <li class="panel-item">
              <div class="item-left">
                <span class="icon">ğŸ§°</span>
                <span>ê³ ê°ì„¼í„°</span>
              </div>
              <div class="item-right"><span class="chevron">â€º</span></div>
            </li>
            <li class="panel-item">
              <div class="item-left">
                <span class="icon">ğŸ“ˆ</span>
                <span>ì‹ ë¢° ì§€ìˆ˜</span>
              </div>
              <div class="item-right"><span class="chevron">â€º</span></div>
            </li>
          </ul>
        </article>
      </section>

      <!-- ì‹ ë¢° ë°°ë„ˆ -->
      <aside class="trust-banner card">
        <div class="badge">â­</div>
        <div class="trust-text">
          <h3>ë¯¿ì„ ìˆ˜ ìˆëŠ” ì´ì›ƒ</h3>
          <p>
            <strong id="trustCount">0</strong>íšŒì˜ ì„±ê³µì ì¸ ê±°ë˜ë¥¼
            ì™„ë£Œí–ˆì–´ìš”!
          </p>
        </div>
      </aside>
    </div>
  </div>

  <!-- ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸ (ë¡œê·¸ì•„ì›ƒ ë“±) -->
  <script src="../JS/auth.js"></script>
  <script src="../JS/my.js"></script>
  <div id="modal-root"></div>
  <script src="../Components/sidebar-auth.js"></script>

  <!-- âœ… DBì—ì„œ ë‚´ ì •ë³´ ë¡œë”© + í”„ë¡œí•„ ìˆ˜ì • ë²„íŠ¼ ì—°ê²° -->
  <script>
    // í”„ë¡œí•„ ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™
    const editBtn = document.getElementById("btnEditProfile");
    if (editBtn) {
      editBtn.addEventListener("click", () => {
        location.href = "edit_profile.html";
      });
    }

    // APIë¡œ ë‚´ ì •ë³´ ì¡°íšŒí•´ì„œ í™”ë©´ì— ë¿Œë¦¬ê¸°
    async function loadMe() {
      try {
        const res = await fetch("/api/user/me");
        if (!res.ok) {
          console.error("me api failed:", res.status);
          return;
        }

        const me = await res.json();

        // ë‹‰ë„¤ì„ / ë™ë„¤
        const nickname = me.nickname || me.userId || "ì‚¬ìš©ì";
        const dong = me.dong || "ë‚´ ë™ë„¤";

        document.getElementById("nicknameText").textContent = nickname;
        document.getElementById("dongText").textContent = dong;

        // ì•„ë°”íƒ€ ê¸€ì
        const initial =
          me.profileInitial ||
          (nickname && nickname.length > 0 ? nickname[0] : "?");
        document.getElementById("avatarText").textContent = initial;

        // ìŠ¤íƒ¯
        document.getElementById("statShared").textContent =
          me.sharedCount ?? 0;
        document.getElementById("statThanks").textContent =
          me.thanksCount ?? 0;
        document.getElementById("statTrust").textContent =
          (me.trustPercent ?? 0) + "%";

        // ë°°ë„ˆ ìˆ«ì(ì„ì‹œ: thanksCountë¡œ ì—°ê²°)
        document.getElementById("trustCount").textContent =
          me.thanksCount ?? 0;
      } catch (e) {
        console.error(e);
      }
    }

    loadMe();
  </script>
</body>
</html>
