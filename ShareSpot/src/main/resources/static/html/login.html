<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>로그인 • 시흥 공유마켓</title>

    <!-- 공통 스타일 -->
    <link rel="stylesheet" href="../Css/style.css" />
    <!-- 로그인 전용 스타일 -->
    <link rel="stylesheet" href="../Css/login.css" />
  </head>

  <body>
    <main class="login-wrap">
      <!-- 상단 히어로 -->
      <section class="hero hero-plain">
        <header class="brand login-brand">
          <a href="./main.html" class="brand-link" aria-label="메인으로 이동">
            <div class="brand-mark">
              <img src="../images/logo.png" alt="시흥 공유마켓 로고" />
            </div>
          </a>
          <h1 class="brand-title">쉐어스팟</h1>
          <p class="brand-subtitle">우리 동네 물품 공유 플랫폼</p>
        </header>
      </section>

      <!-- 로그인 카드 -->
      <section class="login-card card">
        <form id="loginForm" novalidate>
          <div class="form-field">
            <label for="loginId">아이디</label>
            <input
              id="loginId"
              name="loginId"
              type="text"
              placeholder="아이디를 입력하세요"
              autocomplete="username"
            />
            <p class="field-help" aria-live="polite"></p>
          </div>

          <div class="form-field">
            <label for="loginPw">비밀번호</label>
            <input
              id="loginPw"
              name="loginPw"
              type="password"
              placeholder="비밀번호를 입력하세요"
              autocomplete="current-password"
            />
            <p class="field-help" aria-live="polite"></p>
          </div>

          <button type="submit" class="btn-primary btn-block">로그인</button>

          <!-- ✅ 에러 메시지(아까 파일의 loginErr 역할) -->
          <p id="loginErr" class="error" aria-live="polite"></p>
        </form>

        <div class="login-links">
          <!-- 아까 파일이 register.html이면 여기 링크도 그쪽으로 맞추기 -->
          <a href="./signup.html" class="link strong">회원가입</a>
        </div>
      </section>

      <!-- 푸터 -->
      <footer class="login-footer">
        <p>시흥시 물품 공유 서비스</p>
        <p>이용약관 • 개인정보처리방침</p>
      </footer>
    </main>

    <!-- 토스트 (선택) -->
    <div id="toast" class="toast" role="status" aria-live="polite">
      로그인되었습니다!
    </div>

    <!-- ✅ "작동하던 로직"에 필요: Auth.login이 정의된 파일 -->
    <script src="../JS/auth.js"></script>

    <!-- ✅ 이 페이지에서 로그인 처리 -->
    <script>
      const form = document.getElementById("loginForm");
      const errEl = document.getElementById("loginErr");

      function showToast(msg = "로그인되었습니다!") {
        const toast = document.getElementById("toast");
        if (!toast) return;
        toast.textContent = msg;
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 1500);
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        errEl.textContent = "";

        const id = document.getElementById("loginId").value.trim();
        const pw = document.getElementById("loginPw").value.trim();

        const ok = await Auth.login(id, pw);

        if (!ok) {
          errEl.textContent = "아이디 또는 비밀번호가 올바르지 않습니다.";
          return;
        }

        showToast();
        // 로그인 성공 → 메인으로
        setTimeout(() => {
          location.href = "./main.html";
        }, 600);
      });
    </script>
  </body>
</html>
